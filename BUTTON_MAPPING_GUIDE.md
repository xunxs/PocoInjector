# 交互式按钮映射工具使用指南

## 🎯 工具概述

这套工具帮助您将游戏中的按钮与检测到的按钮对象一一对应，建立稳定的映射关系。

## 📁 文件说明

### 1. `button_mapper.py` - 图形界面版本
- **功能**: 弹窗式按钮映射工具
- **特点**: 图形界面，操作直观
- **要求**: 需要 tkinter 支持

### 2. `simple_button_mapper.py` - 命令行版本
- **功能**: 命令行按钮映射工具
- **特点**: 纯文本界面，兼容性好
- **要求**: 只需要 Python 标准库

### 3. `button_controller.py` - 按钮控制器
- **功能**: 基于映射的按钮操作工具
- **特点**: 交互式命令界面
- **用途**: 测试和使用映射结果

## 🚀 使用流程

### 第一步：创建按钮映射

#### 方法一：图形界面版本
```bash
python button_mapper.py
```

#### 方法二：命令行版本（推荐）
```bash
python simple_button_mapper.py
```

**操作步骤**：
1. 确保游戏正在运行且 PocoInjector 插件已加载
2. 确保您在游戏的主页/主菜单
3. 运行映射工具
4. 根据显示的按钮信息，为每个按钮起名
5. 映射结果自动保存到 `button_mapping.json`

### 第二步：使用按钮映射

```bash
python button_controller.py
```

**可用命令**：
- `list` - 列出所有映射的按钮
- `click <名称>` - 模拟点击按钮
- `find <名称>` - 查找按钮信息
- `help` - 显示帮助
- `quit` - 退出

## 📋 映射示例

### 输入过程
```
📍 正在映射第 1/25 个按钮

📍 按钮信息:
   名称: Home_Button_Page
   位置: (11.2, -2.6)
   激活: True
   标签: Untagged
   层级: 5
   组件数: 2
   索引: 0

💡 建议名称:
   1. 主页按钮
   2. 页面按钮
   3. 右侧按钮
   4. 确认按钮
   5. 取消按钮
   6. 功能按钮

请输入按钮名称 (或输入 's' 跳过, 'q' 退出): 主页导航按钮
✅ 已映射: 主页导航按钮 -> 索引 0
```

### 输出文件

#### `button_mapping.json` (JSON格式)
```json
{
  "主页导航按钮": {
    "index": 0,
    "original_name": "Home_Button_Page",
    "position": {
      "x": 11.231482,
      "y": -2.6111112,
      "z": 0
    },
    "active": true,
    "tag": "Untagged",
    "layer": 5,
    "components": [...]
  }
}
```

#### `button_mapping_readable.txt` (可读格式)
```
按钮映射表
==================================================

名称: 主页导航按钮
  原始名称: Home_Button_Page
  索引: 0
  位置: (11.2, -2.6)
  激活: True
  标签: Untagged
  层级: 5
  组件数: 2
```

## 🎮 使用技巧

### 1. 命名建议
- **功能导向**: 根据按钮功能命名（如"退出按钮"、"设置按钮"）
- **位置导向**: 根据按钮位置命名（如"右上角按钮"、"底部按钮"）
- **页面导向**: 根据所属页面命名（如"主页-开始游戏"、"设置-音量调节"）

### 2. 映射策略
- **优先重要按钮**: 先映射核心功能按钮
- **批量处理**: 相似功能的按钮可以批量映射
- **跳过无关**: 不确定的按钮可以先跳过

### 3. 验证方法
- **位置对照**: 根据坐标位置对照游戏画面
- **名称对照**: 根据原始名称判断功能
- **测试验证**: 使用控制器测试映射结果

## 🔧 高级功能

### 1. 模糊查找
控制器支持模糊匹配，输入部分名称即可找到按钮：
```
find 主页
find 按钮
find 退出
```

### 2. 批量操作
可以编写脚本批量操作按钮：
```python
controller = ButtonController()
controller.load_mapping()

# 批量点击
buttons_to_click = ["主页按钮", "设置按钮", "退出按钮"]
for button_name in buttons_to_click:
    controller.click_button(button_name)
```

### 3. 映射更新
- 重新运行映射工具可以更新映射
- 新的映射会覆盖旧的映射
- 建议定期更新映射以保持准确性

## 🚨 注意事项

### 1. 游戏状态
- 确保在正确的游戏页面进行映射
- 不同页面的按钮会不同
- 建议为每个主要页面创建单独的映射

### 2. 按钮变化
- 游戏更新可能改变按钮位置或名称
- 定期检查和更新映射
- 保存多个版本的映射文件

### 3. 坐标系统
- 当前使用的是 Unity 世界坐标
- 实际点击需要转换为屏幕坐标
- 坐标转换功能需要进一步开发

## 📈 后续开发

### 1. 坐标转换
- 实现 Unity 坐标到屏幕坐标的转换
- 支持不同分辨率的适配
- 添加坐标偏移和缩放功能

### 2. 实际点击
- 集成鼠标点击功能
- 支持不同点击方式（单击、双击、长按）
- 添加点击延迟和重试机制

### 3. 自动化脚本
- 基于映射创建自动化流程
- 支持条件判断和循环操作
- 添加错误处理和日志记录

## 🎉 总结

这套工具解决了按钮映射的核心问题：
- ✅ **可视化映射**: 直观的界面让您轻松建立映射
- ✅ **稳定引用**: 通过名称而非索引引用按钮
- ✅ **易于维护**: 清晰的映射文件便于更新
- ✅ **扩展性强**: 为后续自动化开发奠定基础

现在您可以开始创建自己的游戏自动化脚本了！
